<div appUserProfile #userProfile="userProfile" class="flex-auto">

    <mat-sidenav-container>
      <mat-sidenav class="black-to-blue-gradient text-center flex flex-col" [(opened)]="opened" mode="side">

        <p class="mt-2 text-2xl underline">Статус</p>
        <div class="text-left ml-6 mb-4">
            <p class="text-lg">Новая</p>
            <p class="mb-2"><mat-slide-toggle [(ngModel)]="statusNew" (click)="getAllBreakages()"></mat-slide-toggle></p>

            <p class="text-lg">Решена</p>
            <p class="mb-2"><mat-slide-toggle [(ngModel)]="statusSolved" (click)="getAllBreakages()"></mat-slide-toggle></p>

            <p class="text-lg">В работе</p>
            <p class="mb-2"><mat-slide-toggle [(ngModel)]="statusInProgress" (click)="getAllBreakages()"></mat-slide-toggle></p>

            <p class="text-lg">В ожидании</p>
            <p class="mb-2"><mat-slide-toggle [(ngModel)]="statusPaused" (click)="getAllBreakages()"></mat-slide-toggle></p>

            <p class="text-lg">Передана</p>
            <p class="mb-2"><mat-slide-toggle [(ngModel)]="statusRedirected" (click)="getAllBreakages()"></mat-slide-toggle></p>

            <p class="text-lg">Отменена</p>
            <p class="mb-2"><mat-slide-toggle [(ngModel)]="statusCancelled" (click)="getAllBreakages()"></mat-slide-toggle></p>
        </div>
        

        <p class="mt-2 text-2xl underline">Приоритет</p>

        <div class="text-left ml-6 mb-4">
            <p class="text-lg">Важный</p>
            <p class="mb-2"><mat-slide-toggle [(ngModel)]="priorityUrgently" (click)="getAllBreakages()"></mat-slide-toggle></p>

            <p class="text-lg">Высокий</p>
            <p class="mb-2"><mat-slide-toggle [(ngModel)]="priorityHigh" (click)="getAllBreakages()"></mat-slide-toggle></p>

            <p class="text-lg">Средний</p>
            <p class="mb-2"><mat-slide-toggle [(ngModel)]="priorityMedium" (click)="getAllBreakages()"></mat-slide-toggle></p>

            <p class="text-lg">Низкий</p>
            <p class="mb-2"><mat-slide-toggle [(ngModel)]="priorityLow" (click)="getAllBreakages()"></mat-slide-toggle></p>
        </div>
        
        @if (!userProfile.getUserProfile().isEmployee()) {
            <p class="mt-2 text-2xl underline">Параметры</p>

            <div class="text-left">
                <p class="text-lg ml-6 mb-1">Назначенные на:</p>
                <form>
                    <mat-form-field>
                        <mat-select [(ngModel)]="executor" name="appointed">
                            @for (executor of executors; track executor) {
                                <mat-option [value]="executor.value" (click)="getAllBreakages()">{{executor.viewValue}}</mat-option>
                            }
                        </mat-select>
                    </mat-form-field>
                </form>
            </div>

            @if (executor !== 'NO_APPOINTED') {
                <div class="text-left ml-6 mb-4">
                    <p class="text-lg">Просроченные</p>
                    <p class="mb-2"><mat-slide-toggle [(ngModel)]="deadline" (click)="getAllBreakages()"></mat-slide-toggle></p>
                </div>
            }
        }

      </mat-sidenav>
        
    <mat-sidenav-content class="bgi">

    <button mat-icon-button (click)="opened = !opened" class="example-icon fixed" aria-label="Example icon-button with menu icon">
        <mat-icon class="mat-icon-sidenav">menu</mat-icon>
    </button>
        
    <div class="flex">

        <div class="grow ml-20 mr-36">

            <mat-form-field class="!block">
                <mat-label class="">
                    @if (inputError) {
                        <div class="text-xl">
                            <p style="color: #FFB4AB;">Текст заявки должен быть не менее трех символов !!!</p>
                        </div>
                    } @else {
                        Поиск по тексту заявки
                    }
                    
                </mat-label>
                    <input matInput (keyup)="applyFilter($event)" #input>
            </mat-form-field>

            <div [ngClass]="getAllBreakagesError.status < 400 ? 'hide' : 'pb-4' ">
                <p style="color: #FFB4AB;" class="text-center"> {{ getAllBreakagesError.message }} </p> 
            </div>
    
            <div class="mat-elevation-z8">
                <table mat-table [dataSource]="dataSource" matSort (matSortChange)="sortData($event)">

                    <!-- number Column -->
                    <ng-container matColumnDef="number">
                        <th mat-header-cell *matHeaderCellDef class="max-w-10 min-w-10"> {{ number }} </th>
                        <td mat-cell *matCellDef="let element; let i = index" class="max-w-10 min-w-10 one-long-line"
                        (click)="getBreakageById(element.id, userProfile.getUserProfile().isEmployee())"> {{ 
                        this.paginator.pageIndex == 
                         0 ? i + 1 : 1 + i + this.paginator.pageIndex * this.paginator.pageSize }} </td>
                    </ng-container>
        
                    <!-- departmentName Column -->
                    <ng-container matColumnDef="departmentName">  
                        <!-- <th mat-header-cell *matHeaderCellDef mat-sort-header class="max-w-24 min-w-24"> {{ departmentName }} </th>
                        <td mat-cell *matCellDef="let element" class="max-w-24 min-w-24 one-long-line" -->
                        <th mat-header-cell *matHeaderCellDef mat-sort-header
                            [ngClass]="userProfile.getUserProfile().isEmployee() ? 'max-w-32 min-w-32' : 'max-w-24 min-w-24'"
                            > {{ departmentName }} </th>
                        <td mat-cell *matCellDef="let element" class="one-long-line"
                            [ngClass]="userProfile.getUserProfile().isEmployee() ? 'max-w-32 min-w-32' : 'max-w-24 min-w-24'"
                            (click)="getBreakageById(element.id, userProfile.getUserProfile().isEmployee())"
                            > {{ element.departmentName }} </td>
                    </ng-container>

                    <!-- room Column -->
                    <ng-container matColumnDef="room">  
                        <!-- <th mat-header-cell *matHeaderCellDef mat-sort-header class="max-w-24 min-w-24"> {{ room }} </th>
                        <td mat-cell *matCellDef="let element" class="max-w-24 min-w-24 one-long-line" -->
                        <th mat-header-cell *matHeaderCellDef mat-sort-header 
                            [ngClass]="userProfile.getUserProfile().isEmployee() ? 'max-w-32 min-w-32' : 'max-w-24 min-w-24'"
                            > {{ room }} </th>
                        <td mat-cell *matCellDef="let element" class="one-long-line"
                            [ngClass]="userProfile.getUserProfile().isEmployee() ? 'max-w-32 min-w-32' : 'max-w-24 min-w-24'"
                            (click)="getBreakageById(element.id, userProfile.getUserProfile().isEmployee())"
                            > {{ element.room }} </td>
                    </ng-container>

                    <!-- breakageTopic Column -->
                    <ng-container matColumnDef="breakageTopic">  
                        <!-- <th mat-header-cell *matHeaderCellDef mat-sort-header class="max-w-32 min-w-32"> {{ breakageTopic }} </th>
                        <td mat-cell *matCellDef="let element" class="max-w-32 min-w-32 one-long-line" -->
                        <th mat-header-cell *matHeaderCellDef mat-sort-header 
                            [ngClass]="userProfile.getUserProfile().isEmployee() ? 'max-w-40 min-w-40' : 'max-w-32 min-w-32'"
                            > {{ breakageTopic }} </th>
                        <td mat-cell *matCellDef="let element" class="one-long-line"
                            [ngClass]="userProfile.getUserProfile().isEmployee() ? 'max-w-40 min-w-40' : 'max-w-32 min-w-32'"
                            (click)="getBreakageById(element.id, userProfile.getUserProfile().isEmployee())"
                            > {{ element.breakageTopic }} </td>
                    </ng-container>

                    <!-- status Column -->
                    <ng-container matColumnDef="status">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="max-w-24 min-w-24"> {{ status }} </th>
                        <td mat-cell *matCellDef="let element" class="max-w-24 min-w-24 one-long-line"
                        (click)="getBreakageById(element.id, userProfile.getUserProfile().isEmployee())"
                        [ngClass]="{
                            'colorRed': element.status === 'NEW', 'colorLawngreen': element.status === 'SOLVED',
                            'colorAqua': element.status === 'IN_PROGRESS', 'colorFuchsia': element.status === 'PAUSED',
                            'colorGold': element.status === 'REDIRECTED', 'colorGreen': element.status === 'CANCELLED'
                            }"> {{ statusMap.get(element.status) }} </td>
                    </ng-container>
    
                    <!-- priority Column -->
                    @if (!userProfile.getUserProfile().isEmployee()) {
                        <ng-container matColumnDef="priority">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header class="max-w-20 min-w-20"> {{ priority }} </th>
                            <td mat-cell *matCellDef="let element" class="max-w-20 min-w-20 one-long-line"
                            (click)="getBreakageById(element.id, userProfile.getUserProfile().isEmployee())"> 
                            <mat-icon class="mat-icon-priority"
                            [ngClass]="{
                            'colorRed': element.priority === 'URGENTLY', 'colorGold': element.priority === 'HIGH', 
                            'colorLawngreen': element.priority === 'MEDIUM', 'colorAqua': element.priority === 'LOW'
                            }"
                            >turned_in</mat-icon> {{ priorityMap.get(element.priority) }} </td>
                        </ng-container>
                    }                    

                    <!-- breakageExecutor Column --> 
                    <ng-container matColumnDef="breakageExecutor">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="max-w-24 min-w-24"> {{ breakageExecutor }} </th>
                        <td mat-cell *matCellDef="let element" class="max-w-24 min-w-24 one-long-line"
                        [ngClass]="{'colorRed': !userProfile.getUserProfile().isEmployee() && 
                                                element.deadline != null &&
                                                now != null &&
                                                element.deadline < now }"
                        (click)="getBreakageById(element.id, userProfile.getUserProfile().isEmployee())"> {{ element.breakageExecutor }} </td>
                    </ng-container>
    
                    <!-- createdBy Column -->
                    <ng-container matColumnDef="createdBy">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="max-w-24 min-w-24"> {{ createdBy }} </th>
                        <td mat-cell *matCellDef="let element" class="max-w-24 min-w-24 one-long-line"
                        (click)="getBreakageById(element.id, userProfile.getUserProfile().isEmployee())"> {{ element.createdBy }} </td>
                    </ng-container>

                    <!-- createdDate Column -->
                    <ng-container matColumnDef="createdDate">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="max-w-20 min-w-20"> {{ createdDate }} </th>
                        <td mat-cell *matCellDef="let element" class="max-w-20 min-w-20"
                        (click)="getBreakageById(element.id, userProfile.getUserProfile().isEmployee())"
                        > {{ element.createdDate | date: dateFormat }} </td>
                    </ng-container>
    
                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    
                    <!-- Row shown when there is no matching data. -->
                    <tr class="mat-row" *matNoDataRow>
                    <td class="mat-cell" colspan="4">Данные отсутствуют</td>
                    </tr>
                </table>
    
                <mat-paginator  
                      [pageSizeOptions]="[10, 20, 50]"
                      [length]="totalElements"
                      [pageIndex]="pageIndex"
                      [pageSize]="pageSize"
                      (page)="pageEvent = $event; onPaginateChange($event)"
                      showFirstLastButtons
                      aria-label="Select page of periodic elements" 
                      class="text-montserrat">
                </mat-paginator>

                <!-- <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" aria-label="Select page of users"></mat-paginator> -->
            </div>
        </div>

        <div class="fixed top-48 right-4">
        <!-- <div class="float-right mt-20 mr-3"> -->
            <button class="btn button-size black-to-blue-gradient text-montserrat mouse-enter" (click)="createBreakage()">
            Создать
            </button>
        </div>

    </div>

        </mat-sidenav-content>
    </mat-sidenav-container>
</div>
